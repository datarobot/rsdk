# Copyright 2021 DataRobot, Inc. and its affiliates.
#
# All rights reserved.
#
# DataRobot, Inc.
#
# This is proprietary source code of DataRobot, Inc. and its
# affiliates.

# Public API
#
# DataRobot's Public facing API
#
# The version of the OpenAPI document: 2.28.0
# Contact: api-maintainer@datarobot.com
# Generated by: https://openapi-generator.tech

#' @docType class
#' @title FeatureImpactResponse
#'
#' @description FeatureImpactResponse Class
#'
#' @format An \code{R6Class} generator object
#'
#' @field count  integer Number of feature impact records in a given batch.
#'
#' @field featureImpacts  list( \link{FeatureImpactItem} ) A list which contains feature impact scores for each feature used by a model. If the model has more than 1000 features, the most important 1000 features are returned.
#'
#' @field next_  character URL for the next page of results or &#x60;null&#x60;.
#'
#' @field previous  character URL for the next page of results or &#x60;null&#x60;.
#'
#' @field ranRedundancyDetection  character Indicates whether redundant feature identification was run while calculating this feature impact.
#'
#' @field rowCount  integer The number of rows that was used to calculate feature impact. For the feature impact calculated with the default logic, without specifying the &#x60;&#x60;rowCount&#x60;&#x60;, we return &#x60;&#x60;null&#x60;&#x60; here.
#'
#' @field shapBased  character Indicates whether feature impact was calculated using Shapley values. True for anomaly detection models when the project is unsupervised, as permutation approach is not applicable. Note that supervised projects must use an alternative route for SHAP impact: /api/v2/projects/(projectId)/models/(modelId)/shapImpact/
#'
#' @importFrom R6 R6Class
#' @importFrom jsonlite fromJSON toJSON
#' @export
FeatureImpactResponse <- R6::R6Class(
  "FeatureImpactResponse",
  lock_objects = FALSE,
  private = list(
    # @description A helper function to handle assist with type validation. This function will validate class parameters with definite
    # types assigned to them, as well as handling validation of parameters with anyOf and oneOf types listed. These types
    # can themselves be other R6 objects.
    validateProps = function(count = NULL, featureImpacts = NULL, next_ = NULL, previous = NULL, ranRedundancyDetection = NULL, rowCount = NULL, shapBased = NULL) {
      if (!is.null(`count`)) {
        stopifnot(is.numeric(`count`), length(`count`) == 1)
      }
      if (!is.null(`featureImpacts`)) {
        stopifnot(is.vector(`featureImpacts`))
      }
      if (!is.null(`next_`)) {
        stopifnot(is.character(`next_`), length(`next_`) == 1)
      }
      if (!is.null(`previous`)) {
        stopifnot(is.character(`previous`), length(`previous`) == 1)
      }
      if (!is.null(`ranRedundancyDetection`)) {
        stopifnot(is.logical(`ranRedundancyDetection`), length(`ranRedundancyDetection`) == 1)
      }
      if (!is.null(`rowCount`)) {
        stopifnot(is.numeric(`rowCount`), length(`rowCount`) == 1)
      }
      if (!is.null(`shapBased`)) {
        stopifnot(is.logical(`shapBased`), length(`shapBased`) == 1)
      }
    }
  ),
  public = list(
    `count` = NULL,
    `featureImpacts` = NULL,
    `next_` = NULL,
    `previous` = NULL,
    `ranRedundancyDetection` = NULL,
    `rowCount` = NULL,
    `shapBased` = NULL,
    #' @description A function used to initialize an instance of this class.
    #' @param count Number of feature impact records in a given batch.
    #' @param featureImpacts A list which contains feature impact scores for each feature used by a model. If the model has more than 1000 features, the most important 1000 features are returned.
    #' @param next_ URL for the next page of results or &#x60;null&#x60;.
    #' @param previous URL for the next page of results or &#x60;null&#x60;.
    #' @param ranRedundancyDetection Indicates whether redundant feature identification was run while calculating this feature impact.
    #' @param rowCount The number of rows that was used to calculate feature impact. For the feature impact calculated with the default logic, without specifying the &#x60;&#x60;rowCount&#x60;&#x60;, we return &#x60;&#x60;null&#x60;&#x60; here.
    #' @param shapBased Indicates whether feature impact was calculated using Shapley values. True for anomaly detection models when the project is unsupervised, as permutation approach is not applicable. Note that supervised projects must use an alternative route for SHAP impact: /api/v2/projects/(projectId)/models/(modelId)/shapImpact/
    #' @param validateParams An optional param for auto validating this object's parameters before initialization. Default FALSE.
    #' @param ... Any additional keyword arguments to be passed into this object for initialization.
    initialize = function(`count` = NULL, `featureImpacts` = NULL, `next_` = NULL, `previous` = NULL, `ranRedundancyDetection` = NULL, `rowCount` = NULL, `shapBased` = NULL, validateParams = FALSE, ...) {
      local.optional.var <- list(...)
      requiredProps <- list(`count`, `featureImpacts`, `next_`, `previous`, `ranRedundancyDetection`, `rowCount`, `shapBased`)
      if (validateParams) {
        lapply(requiredProps, missing)
        private$validateProps(count, featureImpacts, next_, previous, ranRedundancyDetection, rowCount, shapBased)
      }
      self$`count` <- `count`
      sapply(`featureImpacts`, function(x) stopifnot(R6::is.R6(x)))
      self$`next_` <- `next_`
      self$`previous` <- `previous`
      self$`ranRedundancyDetection` <- `ranRedundancyDetection`
      self$`rowCount` <- `rowCount`
      self$`shapBased` <- `shapBased`
    },
    #' @description A helper function that provides public access to the private validateProps function. This allows users the ability
    #' to programmatically validate objects before sending them to DataRobot.
    validate = function() {
      props <- list(count = self$`count`, featureImpacts = self$`featureImpacts`, next_ = self$`next_`, previous = self$`previous`, ranRedundancyDetection = self$`ranRedundancyDetection`, rowCount = self$`rowCount`, shapBased = self$`shapBased`)
      do.call(private$validateProps, props)
    },
    #' @description A helper function that serializes this object into a JSON encoded string.
    toJSON = function() {
      jsoncontent <- c(
        if (!is.null(self$`count`)) {
          sprintf(
            '"count":
            %d
                  ',
            self$`count`
          )
        },
        if (!is.null(self$`featureImpacts`)) {
          sprintf(
            '"featureImpacts":
            [%s]
',
            paste(sapply(self$`featureImpacts`, function(x) jsonlite::toJSON(x$toJSON(), auto_unbox = TRUE, digits = NA)), collapse = ",")
          )
        },
        if (!is.null(self$`next_`)) {
          sprintf(
            '"next":
            "%s"
                  ',
            self$`next_`
          )
        },
        if (!is.null(self$`previous`)) {
          sprintf(
            '"previous":
            "%s"
                  ',
            self$`previous`
          )
        },
        if (!is.null(self$`ranRedundancyDetection`)) {
          sprintf(
            '"ranRedundancyDetection":
            %s
                  ',
            tolower(self$`ranRedundancyDetection`)
          )
        },
        if (!is.null(self$`rowCount`)) {
          sprintf(
            '"rowCount":
            %d
                  ',
            self$`rowCount`
          )
        },
        if (!is.null(self$`shapBased`)) {
          sprintf(
            '"shapBased":
            %s
                  ',
            tolower(self$`shapBased`)
          )
        }
      )
      jsoncontent <- paste(jsoncontent, collapse = ",")
      paste("{", jsoncontent, "}", sep = "")
    },
    #' @description A helper function that deserializes a JSON string into an instance of this class.
    #' @param FeatureImpactResponseJson A JSON encoded string representation of a class instance.
    #' @param validateParams An optional param for auto validating this object's parameters after deserialization. Default FALSE.
    fromJSON = function(FeatureImpactResponseJson, validateParams = FALSE) {
      FeatureImpactResponseObject <- jsonlite::fromJSON(FeatureImpactResponseJson)
      self$`count` <- FeatureImpactResponseObject$`count`
      self$`featureImpacts` <- ApiClient$new()$deserializeObj(FeatureImpactResponseObject$`featureImpacts`, "array[FeatureImpactItem]", loadNamespace("datarobot.apicore"))
      self$`next_` <- FeatureImpactResponseObject$`next`
      self$`previous` <- FeatureImpactResponseObject$`previous`
      self$`ranRedundancyDetection` <- FeatureImpactResponseObject$`ranRedundancyDetection`
      self$`rowCount` <- FeatureImpactResponseObject$`rowCount`
      self$`shapBased` <- FeatureImpactResponseObject$`shapBased`

      if (validateParams) {
        self$validate()
      }

      return(self)
    }
  )
)
