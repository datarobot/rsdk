# Copyright 2021-2022 DataRobot, Inc. and its affiliates.
#
# All rights reserved.
#
# DataRobot, Inc.
#
# This is proprietary source code of DataRobot, Inc. and its
# affiliates.

# Public API
#
# DataRobot's Public facing API
#
# The version of the OpenAPI document: 2.29.0
# Contact: api-maintainer@datarobot.com
# Generated by: https://openapi-generator.tech

#' @docType class
#' @title Relationship
#'
#' @description Relationship Class
#'
#' @format An \code{R6Class} generator object
#'
#' @field dataset1Identifier  character [optional] Identifier of the first dataset in the relationship. If this is not provided, it represents the primary dataset.
#'
#' @field dataset1Keys  list( character ) column(s) in the first dataset that are used to join to the second dataset.
#'
#' @field dataset2Identifier  character Identifier of the second dataset in the relationship.
#'
#' @field dataset2Keys  list( character ) column(s) in the second dataset that are used to join to the first dataset.
#'
#' @field featureDerivationWindowEnd  integer [optional] How many featureDerivationWindowUnits of each dataset&#39;s primary temporal key into the past relative to the datetimePartitionColumn the feature derivation window should end. Will be a non-positive integer, if present. If present, time-aware joins will be used. Only applicable when table1Identifier is not provided.
#'
#' @field featureDerivationWindowStart  integer [optional] How many featureDerivationWindowUnits of each dataset&#39;s primary temporal key into the past relative to the datetimePartitionColumn the feature derivation window should begin. Will be a negative integer, if present. If present, time-aware joins will be used. Only applicable when table1Identifier is not provided.
#'
#' @field featureDerivationWindowTimeUnit  character [optional] Time unit of the feature derivation window. Supported values are MILLISECOND, SECOND, MINUTE, HOUR, DAY, WEEK, MONTH, QUARTER, YEAR. If present, time-aware joins will be used. Only applicable when table1Identifier is not provided.
#'
#' @field featureDerivationWindows  list( \link{FeatureDerivationWindow} ) [optional] List of feature derivation window definitions that will be used.
#'
#' @field predictionPointRounding  integer [optional] Closest value of predictionPointRoundingTimeUnit to round the prediction point into the past when applying the feature derivation window. Will be a positive integer, if present. Only applicable when table1Identifier is not provided.
#'
#' @field predictionPointRoundingTimeUnit  character [optional] Time unit of the prediction point rounding. Supported values are MILLISECOND, SECOND, MINUTE, HOUR, DAY, WEEK, MONTH, QUARTER, YEAR. Only applicable when table1Identifier is not provided.
#'
#' @importFrom R6 R6Class
#' @importFrom jsonlite fromJSON toJSON
#' @export
Relationship <- R6::R6Class(
  "Relationship",
  lock_objects = FALSE,
  private = list(
    # @description The properties of this object that are required to be set.
    # @description A helper function to handle assist with type validation. This function will validate class parameters with definite
    # types assigned to them, as well as handling validation of parameters with anyOf and oneOf types listed. These types
    # can themselves be other R6 objects.
    validateProps = function(`dataset1Identifier` = NULL, `dataset1Keys` = NULL, `dataset2Identifier` = NULL, `dataset2Keys` = NULL, `featureDerivationWindowEnd` = NULL, `featureDerivationWindowStart` = NULL, `featureDerivationWindowTimeUnit` = NULL, `featureDerivationWindows` = NULL, `predictionPointRounding` = NULL, `predictionPointRoundingTimeUnit` = NULL) {
      if (!is.null(`dataset1Keys`)) {
        stopifnot(is.vector(`dataset1Keys`), sapply(`dataset1Keys`, is.character))
      }
      if (!is.null(`dataset2Identifier`)) {
        stopifnot(is.character(`dataset2Identifier`), length(`dataset2Identifier`) == 1)
      }
      if (!is.null(`dataset2Keys`)) {
        stopifnot(is.vector(`dataset2Keys`), sapply(`dataset2Keys`, is.character))
      }
      if (!is.null(`dataset1Identifier`)) {
        stopifnot(is.character(`dataset1Identifier`), length(`dataset1Identifier`) == 1)
      }
      if (!is.null(`featureDerivationWindowEnd`)) {
        stopifnot(is.numeric(`featureDerivationWindowEnd`), length(`featureDerivationWindowEnd`) == 1)
      }
      if (!is.null(`featureDerivationWindowStart`)) {
        stopifnot(is.numeric(`featureDerivationWindowStart`), length(`featureDerivationWindowStart`) == 1)
      }
      if (!is.null(`featureDerivationWindowTimeUnit`)) {
        stopifnot(is.character(`featureDerivationWindowTimeUnit`), length(`featureDerivationWindowTimeUnit`) == 1)
      }
      if (!is.null(`featureDerivationWindows`) && length(`featureDerivationWindows`) > 0) {
        stopifnot(is.vector(`featureDerivationWindows`), sapply(`featureDerivationWindows`, R6::is.R6))
      }
      if (!is.null(`predictionPointRounding`)) {
        stopifnot(is.numeric(`predictionPointRounding`), length(`predictionPointRounding`) == 1)
      }
      if (!is.null(`predictionPointRoundingTimeUnit`)) {
        stopifnot(is.character(`predictionPointRoundingTimeUnit`), length(`predictionPointRoundingTimeUnit`) == 1)
      }
    }
  ),
  public = list(
    `dataset1Identifier` = NULL,
    `dataset1Keys` = NULL,
    `dataset2Identifier` = NULL,
    `dataset2Keys` = NULL,
    `featureDerivationWindowEnd` = NULL,
    `featureDerivationWindowStart` = NULL,
    `featureDerivationWindowTimeUnit` = NULL,
    `featureDerivationWindows` = NULL,
    `predictionPointRounding` = NULL,
    `predictionPointRoundingTimeUnit` = NULL,
    #' @description A function used to initialize an instance of this class.
    #' @param dataset1Identifier Identifier of the first dataset in the relationship. If this is not provided, it represents the primary dataset.
    #' @param dataset1Keys column(s) in the first dataset that are used to join to the second dataset.
    #' @param dataset2Identifier Identifier of the second dataset in the relationship.
    #' @param dataset2Keys column(s) in the second dataset that are used to join to the first dataset.
    #' @param featureDerivationWindowEnd How many featureDerivationWindowUnits of each dataset&#39;s primary temporal key into the past relative to the datetimePartitionColumn the feature derivation window should end. Will be a non-positive integer, if present. If present, time-aware joins will be used. Only applicable when table1Identifier is not provided.
    #' @param featureDerivationWindowStart How many featureDerivationWindowUnits of each dataset&#39;s primary temporal key into the past relative to the datetimePartitionColumn the feature derivation window should begin. Will be a negative integer, if present. If present, time-aware joins will be used. Only applicable when table1Identifier is not provided.
    #' @param featureDerivationWindowTimeUnit Time unit of the feature derivation window. Supported values are MILLISECOND, SECOND, MINUTE, HOUR, DAY, WEEK, MONTH, QUARTER, YEAR. If present, time-aware joins will be used. Only applicable when table1Identifier is not provided.
    #' @param featureDerivationWindows List of feature derivation window definitions that will be used.
    #' @param predictionPointRounding Closest value of predictionPointRoundingTimeUnit to round the prediction point into the past when applying the feature derivation window. Will be a positive integer, if present. Only applicable when table1Identifier is not provided.
    #' @param predictionPointRoundingTimeUnit Time unit of the prediction point rounding. Supported values are MILLISECOND, SECOND, MINUTE, HOUR, DAY, WEEK, MONTH, QUARTER, YEAR. Only applicable when table1Identifier is not provided.
    #' @param validateParams An optional param for auto validating this object's parameters before initialization. Default FALSE.
    #' @param ... Any additional keyword arguments to be passed into this object for initialization.
    initialize = function(`dataset1Keys` = NULL, `dataset2Identifier` = NULL, `dataset2Keys` = NULL, `dataset1Identifier` = NULL, `featureDerivationWindowEnd` = NULL, `featureDerivationWindowStart` = NULL, `featureDerivationWindowTimeUnit` = NULL, `featureDerivationWindows` = NULL, `predictionPointRounding` = NULL, `predictionPointRoundingTimeUnit` = NULL, validateParams = FALSE, ...) {
      local.optional.var <- list(...)
      if (validateParams) {
        lapply(list(`dataset1Keys`, `dataset2Identifier`, `dataset2Keys`), function(param) {
          stopifnot("Required param not set." = !is.null(param))
        })
        private$validateProps(dataset1Identifier, dataset1Keys, dataset2Identifier, dataset2Keys, featureDerivationWindowEnd, featureDerivationWindowStart, featureDerivationWindowTimeUnit, featureDerivationWindows, predictionPointRounding, predictionPointRoundingTimeUnit)
      }
      self$`dataset1Identifier` <- `dataset1Identifier`
      self$`dataset1Keys` <- `dataset1Keys`
      self$`dataset2Identifier` <- `dataset2Identifier`
      self$`dataset2Keys` <- `dataset2Keys`
      self$`featureDerivationWindowEnd` <- `featureDerivationWindowEnd`
      self$`featureDerivationWindowStart` <- `featureDerivationWindowStart`
      self$`featureDerivationWindowTimeUnit` <- `featureDerivationWindowTimeUnit`
      self$`featureDerivationWindows` <- `featureDerivationWindows`
      self$`predictionPointRounding` <- `predictionPointRounding`
      self$`predictionPointRoundingTimeUnit` <- `predictionPointRoundingTimeUnit`
    },
    #' @description A helper function that provides public access to the private validateProps function. This allows users the ability
    #' to programmatically validate objects before sending them to DataRobot.
    #' checking this objects set properties.
    validate = function() {
      do.call(private$validateProps, list(dataset1Identifier = self$`dataset1Identifier`, dataset1Keys = self$`dataset1Keys`, dataset2Identifier = self$`dataset2Identifier`, dataset2Keys = self$`dataset2Keys`, featureDerivationWindowEnd = self$`featureDerivationWindowEnd`, featureDerivationWindowStart = self$`featureDerivationWindowStart`, featureDerivationWindowTimeUnit = self$`featureDerivationWindowTimeUnit`, featureDerivationWindows = self$`featureDerivationWindows`, predictionPointRounding = self$`predictionPointRounding`, predictionPointRoundingTimeUnit = self$`predictionPointRoundingTimeUnit`))
    },
    #' @description A helper function that serializes this object into a JSON encoded string.
    toJSON = function() {
      jsoncontent <- c(
        if (!is.null(self$`dataset1Identifier`)) {
          sprintf(
            '"dataset1Identifier":
            "%s"
                  ',
            self$`dataset1Identifier`
          )
        },
        if (!is.null(self$`dataset1Keys`)) {
          sprintf(
            '"dataset1Keys":
            [%s]
                  ',
            paste(unlist(lapply(self$`dataset1Keys`, function(x) paste0('"', x, '"'))), collapse = ",")
          )
        },
        if (!is.null(self$`dataset2Identifier`)) {
          sprintf(
            '"dataset2Identifier":
            "%s"
                  ',
            self$`dataset2Identifier`
          )
        },
        if (!is.null(self$`dataset2Keys`)) {
          sprintf(
            '"dataset2Keys":
            [%s]
                  ',
            paste(unlist(lapply(self$`dataset2Keys`, function(x) paste0('"', x, '"'))), collapse = ",")
          )
        },
        if (!is.null(self$`featureDerivationWindowEnd`)) {
          sprintf(
            '"featureDerivationWindowEnd":
            %d
                  ',
            self$`featureDerivationWindowEnd`
          )
        },
        if (!is.null(self$`featureDerivationWindowStart`)) {
          sprintf(
            '"featureDerivationWindowStart":
            %d
                  ',
            self$`featureDerivationWindowStart`
          )
        },
        if (!is.null(self$`featureDerivationWindowTimeUnit`)) {
          sprintf(
            '"featureDerivationWindowTimeUnit":
            "%s"
                  ',
            self$`featureDerivationWindowTimeUnit`
          )
        },
        if (!is.null(self$`featureDerivationWindows`)) {
          sprintf(
            '"featureDerivationWindows":
            [%s]
      ',
            paste(sapply(self$`featureDerivationWindows`, function(x) jsonlite::toJSON(x$toJSON(), auto_unbox = TRUE, digits = NA)), collapse = ",")
          )
        },
        if (!is.null(self$`predictionPointRounding`)) {
          sprintf(
            '"predictionPointRounding":
            %d
                  ',
            self$`predictionPointRounding`
          )
        },
        if (!is.null(self$`predictionPointRoundingTimeUnit`)) {
          sprintf(
            '"predictionPointRoundingTimeUnit":
            "%s"
                  ',
            self$`predictionPointRoundingTimeUnit`
          )
        }
      )
      jsoncontent <- paste(jsoncontent, collapse = ",")
      paste("{", jsoncontent, "}", sep = "")
    },
    #' @description A helper function that deserializes a JSON string into an instance of this class.
    #' @param RelationshipJson A JSON encoded string representation of a class instance.
    #' @param validateParams An optional param for auto validating this object's parameters after deserialization. Default FALSE.
    fromJSON = function(RelationshipJson, validateParams = FALSE) {
      RelationshipObject <- jsonlite::fromJSON(RelationshipJson)
      self$`dataset1Identifier` <- RelationshipObject$`dataset1Identifier`
      self$`dataset1Keys` <- ApiClient$new()$deserializeObj(RelationshipObject$`dataset1Keys`, "array[character]", loadNamespace("datarobot.apicore"))
      self$`dataset2Identifier` <- RelationshipObject$`dataset2Identifier`
      self$`dataset2Keys` <- ApiClient$new()$deserializeObj(RelationshipObject$`dataset2Keys`, "array[character]", loadNamespace("datarobot.apicore"))
      self$`featureDerivationWindowEnd` <- RelationshipObject$`featureDerivationWindowEnd`
      self$`featureDerivationWindowStart` <- RelationshipObject$`featureDerivationWindowStart`
      self$`featureDerivationWindowTimeUnit` <- RelationshipObject$`featureDerivationWindowTimeUnit`
      self$`featureDerivationWindows` <- ApiClient$new()$deserializeObj(RelationshipObject$`featureDerivationWindows`, "array[FeatureDerivationWindow]", loadNamespace("datarobot.apicore"))
      self$`predictionPointRounding` <- RelationshipObject$`predictionPointRounding`
      self$`predictionPointRoundingTimeUnit` <- RelationshipObject$`predictionPointRoundingTimeUnit`

      if (validateParams) {
        self$validate()
      }

      return(self)
    }
  )
)
