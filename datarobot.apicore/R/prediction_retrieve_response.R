# Copyright 2021-2022 DataRobot, Inc. and its affiliates.
#
# All rights reserved.
#
# DataRobot, Inc.
#
# This is proprietary source code of DataRobot, Inc. and its
# affiliates.

# Public API
#
# DataRobot's Public facing API
#
# The version of the OpenAPI document: 2.29.0
# Contact: api-maintainer@datarobot.com
# Generated by: https://openapi-generator.tech

#' @docType class
#' @title PredictionRetrieveResponse
#'
#' @description PredictionRetrieveResponse Class
#'
#' @format An \code{R6Class} generator object
#'
#' @field actualValueColumn  character [optional] For time series unsupervised projects only. Will be present only if the prediction dataset has an actual value column. The name of the column with actuals that was used to calculate the scores and insights.
#'
#' @field explanationAlgorithm  character [optional] The selected algorithm to use for prediction explanations. At present, the only acceptable value is &#39;shap&#39;, which selects the SHapley Additive exPlanations (SHAP) explainer. Defaults to null (no prediction explanations).
#'
#' @field featureDerivationWindowCounts  integer [optional] For time series projects with partial history only. Indicates how many points were used during feature derivation in feature derivation window.
#'
#' @field includesPredictionIntervals  character [optional] For time series projects only. Indicates if prediction intervals will be part of the response. Defaults to False.
#'
#' @field maxExplanations  integer [optional] The maximum number of prediction explanations values to be returned with each row in the &#x60;predictions&#x60; json array. Null indicates &#39;no limit&#39;. Will be present only if &#x60;explanationAlgorithm&#x60; was set.
#'
#' @field positiveClass  \link{OneOfstringintegernumber} For binary classification, the class of the target deemed the positive class. For all other project types this field will be null.
#'
#' @field predictionIntervalsSize  integer [optional] For time series projects only. Will be present only if &#x60;includePredictionIntervals&#x60; is True. Indicates the percentile used for prediction intervals calculation. Defaults to 80.
#'
#' @field predictions  list( \link{PredictionObject} ) The json array of predictions. The predictions in the response will have slightly different formats, depending on the project type.
#'
#' @field shapBaseValue  numeric [optional] Will be present only if &#x60;explanationAlgorithm&#x60; &#x3D; &#39;shap&#39;. The model&#39;s average prediction over the training data. SHAP values are deviations from the base value.
#'
#' @field shapWarnings  list( \link{ShapWarningValues} ) [optional] Will be present if &#x60;explanationAlgorithm&#x60; was set to &#x60;shap&#x60; and there were additivity failures during SHAP values calculation.
#'
#' @field task  character The prediction task.
#'
#' @importFrom R6 R6Class
#' @importFrom jsonlite fromJSON toJSON
#' @export
PredictionRetrieveResponse <- R6::R6Class(
  "PredictionRetrieveResponse",
  lock_objects = FALSE,
  private = list(
    # @description The properties of this object that are required to be set.
    # @description A helper function to handle assist with type validation. This function will validate class parameters with definite
    # types assigned to them, as well as handling validation of parameters with anyOf and oneOf types listed. These types
    # can themselves be other R6 objects.
    validateProps = function(`actualValueColumn` = NULL, `explanationAlgorithm` = NULL, `featureDerivationWindowCounts` = NULL, `includesPredictionIntervals` = NULL, `maxExplanations` = NULL, `positiveClass` = NULL, `predictionIntervalsSize` = NULL, `predictions` = NULL, `shapBaseValue` = NULL, `shapWarnings` = NULL, `task` = NULL) {
      if (!is.null(`positiveClass`)) {
        .setPrimitiveProperty(typeList = list("character", "numeric"), propertyData = positiveClass)
      }
      if (!is.null(`predictions`)) {
        stopifnot(is.vector(`predictions`), sapply(`predictions`, R6::is.R6))
      }
      if (!is.null(`task`)) {
        stopifnot(is.character(`task`), length(`task`) == 1)
      }
      if (!is.null(`actualValueColumn`)) {
        stopifnot(is.character(`actualValueColumn`), length(`actualValueColumn`) == 1)
      }
      if (!is.null(`explanationAlgorithm`)) {
        stopifnot(is.character(`explanationAlgorithm`), length(`explanationAlgorithm`) == 1)
      }
      if (!is.null(`featureDerivationWindowCounts`)) {
        stopifnot(is.numeric(`featureDerivationWindowCounts`), length(`featureDerivationWindowCounts`) == 1)
      }
      if (!is.null(`includesPredictionIntervals`)) {
        stopifnot(is.logical(`includesPredictionIntervals`), length(`includesPredictionIntervals`) == 1)
      }
      if (!is.null(`maxExplanations`)) {
        stopifnot(is.numeric(`maxExplanations`), length(`maxExplanations`) == 1)
      }
      if (!is.null(`predictionIntervalsSize`)) {
        stopifnot(is.numeric(`predictionIntervalsSize`), length(`predictionIntervalsSize`) == 1)
      }
      if (!is.null(`shapBaseValue`)) {
        stopifnot(is.numeric(`shapBaseValue`), length(`shapBaseValue`) == 1)
      }
      if (!is.null(`shapWarnings`) && length(`shapWarnings`) > 0) {
        stopifnot(is.vector(`shapWarnings`), sapply(`shapWarnings`, R6::is.R6))
      }
    }
  ),
  public = list(
    `actualValueColumn` = NULL,
    `explanationAlgorithm` = NULL,
    `featureDerivationWindowCounts` = NULL,
    `includesPredictionIntervals` = NULL,
    `maxExplanations` = NULL,
    `positiveClass` = NULL,
    `predictionIntervalsSize` = NULL,
    `predictions` = NULL,
    `shapBaseValue` = NULL,
    `shapWarnings` = NULL,
    `task` = NULL,
    #' @description A function used to initialize an instance of this class.
    #' @param actualValueColumn For time series unsupervised projects only. Will be present only if the prediction dataset has an actual value column. The name of the column with actuals that was used to calculate the scores and insights.
    #' @param explanationAlgorithm The selected algorithm to use for prediction explanations. At present, the only acceptable value is &#39;shap&#39;, which selects the SHapley Additive exPlanations (SHAP) explainer. Defaults to null (no prediction explanations).
    #' @param featureDerivationWindowCounts For time series projects with partial history only. Indicates how many points were used during feature derivation in feature derivation window.
    #' @param includesPredictionIntervals For time series projects only. Indicates if prediction intervals will be part of the response. Defaults to False.
    #' @param maxExplanations The maximum number of prediction explanations values to be returned with each row in the &#x60;predictions&#x60; json array. Null indicates &#39;no limit&#39;. Will be present only if &#x60;explanationAlgorithm&#x60; was set.
    #' @param positiveClass For binary classification, the class of the target deemed the positive class. For all other project types this field will be null.
    #' @param predictionIntervalsSize For time series projects only. Will be present only if &#x60;includePredictionIntervals&#x60; is True. Indicates the percentile used for prediction intervals calculation. Defaults to 80.
    #' @param predictions The json array of predictions. The predictions in the response will have slightly different formats, depending on the project type.
    #' @param shapBaseValue Will be present only if &#x60;explanationAlgorithm&#x60; &#x3D; &#39;shap&#39;. The model&#39;s average prediction over the training data. SHAP values are deviations from the base value.
    #' @param shapWarnings Will be present if &#x60;explanationAlgorithm&#x60; was set to &#x60;shap&#x60; and there were additivity failures during SHAP values calculation.
    #' @param task The prediction task.
    #' @param validateParams An optional param for auto validating this object's parameters before initialization. Default FALSE.
    #' @param ... Any additional keyword arguments to be passed into this object for initialization.
    initialize = function(`positiveClass` = NULL, `predictions` = NULL, `task` = NULL, `actualValueColumn` = NULL, `explanationAlgorithm` = NULL, `featureDerivationWindowCounts` = NULL, `includesPredictionIntervals` = NULL, `maxExplanations` = NULL, `predictionIntervalsSize` = NULL, `shapBaseValue` = NULL, `shapWarnings` = NULL, validateParams = FALSE, ...) {
      local.optional.var <- list(...)
      if (validateParams) {
        lapply(list(`positiveClass`, `predictions`, `task`), function(param) {
          stopifnot("Required param not set." = !is.null(param))
        })
        private$validateProps(actualValueColumn, explanationAlgorithm, featureDerivationWindowCounts, includesPredictionIntervals, maxExplanations, positiveClass, predictionIntervalsSize, predictions, shapBaseValue, shapWarnings, task)
      }
      self$`actualValueColumn` <- `actualValueColumn`
      self$`explanationAlgorithm` <- `explanationAlgorithm`
      self$`featureDerivationWindowCounts` <- `featureDerivationWindowCounts`
      self$`includesPredictionIntervals` <- `includesPredictionIntervals`
      self$`maxExplanations` <- `maxExplanations`
      self$`positiveClass` <- .setPrimitiveProperty(typeList = list("character", "numeric"), propertyData = positiveClass)
      self$`predictionIntervalsSize` <- `predictionIntervalsSize`
      self$`predictions` <- `predictions`
      self$`shapBaseValue` <- `shapBaseValue`
      self$`shapWarnings` <- `shapWarnings`
      self$`task` <- `task`
    },
    #' @description A helper function that provides public access to the private validateProps function. This allows users the ability
    #' to programmatically validate objects before sending them to DataRobot.
    #' checking this objects set properties.
    validate = function() {
      do.call(private$validateProps, list(actualValueColumn = self$`actualValueColumn`, explanationAlgorithm = self$`explanationAlgorithm`, featureDerivationWindowCounts = self$`featureDerivationWindowCounts`, includesPredictionIntervals = self$`includesPredictionIntervals`, maxExplanations = self$`maxExplanations`, positiveClass = self$`positiveClass`, predictionIntervalsSize = self$`predictionIntervalsSize`, predictions = self$`predictions`, shapBaseValue = self$`shapBaseValue`, shapWarnings = self$`shapWarnings`, task = self$`task`))
    },
    #' @description A helper function that serializes this object into a JSON encoded string.
    toJSON = function() {
      jsoncontent <- c(
        if (!is.null(self$`actualValueColumn`)) {
          sprintf(
            '"actualValueColumn":
            "%s"
                  ',
            self$`actualValueColumn`
          )
        },
        if (!is.null(self$`explanationAlgorithm`)) {
          sprintf(
            '"explanationAlgorithm":
            "%s"
                  ',
            self$`explanationAlgorithm`
          )
        },
        if (!is.null(self$`featureDerivationWindowCounts`)) {
          sprintf(
            '"featureDerivationWindowCounts":
            %d
                  ',
            self$`featureDerivationWindowCounts`
          )
        },
        if (!is.null(self$`includesPredictionIntervals`)) {
          sprintf(
            '"includesPredictionIntervals":
            %s
                  ',
            tolower(self$`includesPredictionIntervals`)
          )
        },
        if (!is.null(self$`maxExplanations`)) {
          sprintf(
            '"maxExplanations":
            %d
                  ',
            self$`maxExplanations`
          )
        },
        if (!is.null(self$`positiveClass`)) {
          sprintf(
            '"positiveClass":
            %s
      ',
            self$`positiveClass`
          )
        },
        if (!is.null(self$`predictionIntervalsSize`)) {
          sprintf(
            '"predictionIntervalsSize":
            %d
                  ',
            self$`predictionIntervalsSize`
          )
        },
        if (!is.null(self$`predictions`)) {
          sprintf(
            '"predictions":
            [%s]
      ',
            paste(sapply(self$`predictions`, function(x) jsonlite::toJSON(x$toJSON(), auto_unbox = TRUE, digits = NA)), collapse = ",")
          )
        },
        if (!is.null(self$`shapBaseValue`)) {
          sprintf(
            '"shapBaseValue":
            %d
                  ',
            self$`shapBaseValue`
          )
        },
        if (!is.null(self$`shapWarnings`)) {
          sprintf(
            '"shapWarnings":
            [%s]
      ',
            paste(sapply(self$`shapWarnings`, function(x) jsonlite::toJSON(x$toJSON(), auto_unbox = TRUE, digits = NA)), collapse = ",")
          )
        },
        if (!is.null(self$`task`)) {
          sprintf(
            '"task":
            "%s"
                  ',
            self$`task`
          )
        }
      )
      jsoncontent <- paste(jsoncontent, collapse = ",")
      paste("{", jsoncontent, "}", sep = "")
    },
    #' @description A helper function that deserializes a JSON string into an instance of this class.
    #' @param PredictionRetrieveResponseJson A JSON encoded string representation of a class instance.
    #' @param validateParams An optional param for auto validating this object's parameters after deserialization. Default FALSE.
    fromJSON = function(PredictionRetrieveResponseJson, validateParams = FALSE) {
      PredictionRetrieveResponseObject <- jsonlite::fromJSON(PredictionRetrieveResponseJson)
      self$`actualValueColumn` <- PredictionRetrieveResponseObject$`actualValueColumn`
      self$`explanationAlgorithm` <- PredictionRetrieveResponseObject$`explanationAlgorithm`
      self$`featureDerivationWindowCounts` <- PredictionRetrieveResponseObject$`featureDerivationWindowCounts`
      self$`includesPredictionIntervals` <- PredictionRetrieveResponseObject$`includesPredictionIntervals`
      self$`maxExplanations` <- PredictionRetrieveResponseObject$`maxExplanations`
      self$`positiveClass` <- .setPrimitiveProperty(typeList = list("character", "numeric"), propertyData = PredictionRetrieveResponseObject$positiveClass)
      self$`predictionIntervalsSize` <- PredictionRetrieveResponseObject$`predictionIntervalsSize`
      self$`predictions` <- ApiClient$new()$deserializeObj(PredictionRetrieveResponseObject$`predictions`, "array[PredictionObject]", loadNamespace("datarobot.apicore"))
      self$`shapBaseValue` <- PredictionRetrieveResponseObject$`shapBaseValue`
      self$`shapWarnings` <- ApiClient$new()$deserializeObj(PredictionRetrieveResponseObject$`shapWarnings`, "array[ShapWarningValues]", loadNamespace("datarobot.apicore"))
      self$`task` <- PredictionRetrieveResponseObject$`task`

      if (validateParams) {
        self$validate()
      }

      return(self)
    }
  )
)
