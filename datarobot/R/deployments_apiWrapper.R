# Copyright 2021 DataRobot, Inc. and its affiliates.
#
# All rights reserved.
#
# DataRobot, Inc.
#
# This is proprietary source code of DataRobot, Inc. and its
# affiliates.

# Public API
#
# DataRobot's Public facing API
#
# The version of the OpenAPI document: 2.28.0
# Contact: api-maintainer@datarobot.com
# Generated by: https://openapi-generator.tech


# NOTE: This file is auto generated by OpenAPI Generator (https://openapi-generator.tech).
# Do not edit the file manually.

# API Wrapper methods for Deployments
# To use these methods without modification, DR endpoint and token
# should be set as environment variables. This will automatically
# happen when you call `datarobot::ConnectToDataRobot()`.



#' ListDeletedDeployments
#'
#' List deleted deployments
#'
#' List deleted deployments.Only available as part of an enterprise (on-prem) installation. Requires a CAN_DELETE_APP_PROJECTS permission to execute.
#'
#' @seealso The method DeletedDeploymentsList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeletedDeployments <- function(offset = 0, limit = 20, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeletedDeploymentsList(offset = offset, limit = limit))
}

#' PatchManyDeletedDeployments
#'
#' Erase deleted deployments
#'
#' Permanently erase data for deleted deployments. Only available as part of an on-premise or private/hybrid cloud deployment. Requires a CAN_DELETE_APP_PROJECTS permission to execute.
#'
#' @seealso The method DeletedDeploymentsPatchMany in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
PatchManyDeletedDeployments <- function(action, deploymentIds, ...) {
  deploymentPermanentDelete <- datarobot.apicore::DeploymentPermanentDelete$new(action = action, deploymentIds = deploymentIds, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeletedDeploymentsPatchMany(deploymentPermanentDelete = deploymentPermanentDelete))
}

#' GetDeploymentAccuracy
#'
#' Retrieve accuracy metric
#'
#' Retrieve accuracy metric for a certain time period.
#'
#' @seealso The method DeploymentsAccuracyList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
GetDeploymentAccuracy <- function(deploymentId, modelId = NULL, start = NULL, end = NULL, segmentAttribute = NULL, segmentValue = NULL, targetClasses = NULL, ...) {
  routeString <- UrlJoin("deployments", deploymentId, "accuracy")
  query <- list()
  query$modelId <- modelId
  if (!is.null(start) && validateReportingPeriodTime(start, "start")) {
    query$start <- formatRFC3339Timestamp(start)
  }
  if (!is.null(end) && validateReportingPeriodTime(end, "end")) {
    query$end <- formatRFC3339Timestamp(end)
  }
  query$segmentAttribute <- segmentAttribute
  query$segmentValue <- segmentValue
  query$targetClasses <- targetClasses
  # start of generated addition
  # end of generated addition
  response <- DataRobotGET(routeString, query = query)
  as.dataRobotDeploymentAccuracy(response)
}

#' ListDeploymentsAccuracyOverTime
#'
#' Retrieve accuracy over time data for one single metric.
#'
#'          Retrieve accuracy over time data for one single metric.          The following metrics can be retrieved.              For classification deployments:              - Accuracy             - AUC             - Balanced Accuracy             - FVE Binomial             - Gini Norm             - Kolmogorov-Smirnov             - LogLoss (default)             - Rate@Top5%             - Rate@Top10%              For regression deployments:              - Gamma Deviance (default)             - FVE Gamma             - FVE Poisson             - FVE Tweedie             - MAD             - MAE             - MAPE             - Poisson Deviance             - R Squared             - RMSE             - RMSLE             - Tweedie Deviance
#'
#' @seealso The method DeploymentsAccuracyOverTimeList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsAccuracyOverTime <- function(segmentAttribute, targetClasses, metric, modelId, deploymentId, start, end, bucketSize, segmentValue = "", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsAccuracyOverTimeList(segmentAttribute = segmentAttribute, targetClasses = targetClasses, metric = metric, modelId = modelId, deploymentId = deploymentId, start = start, segmentValue = segmentValue, end = end, bucketSize = bucketSize))
}

#' CreateDeploymentsActualsFromDataset
#'
#' Submit actuals values from AI Catalog
#'
#' Submit actuals values for processing using catalog item. Submission of actuals is limited to 10,000,000 actuals per hour. For time series deployments, total actuals = number of actuals * number of forecast distances. For example, submitting 10 actuals for a deployment with 50 forecast distances = 500 total actuals. For multiclass deployments, a similar calculation is made where total actuals = number of actuals * number of classes. For example, submitting 10 actuals for a deployment with 20 classes = 200 actuals.
#'
#' @seealso The method DeploymentsActualsFromDatasetCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsActualsFromDataset <- function(password, wasActedOnColumn, associationIdColumn, actualValueColumn, deploymentId, datasetId, user, datasetVersionId, timestampColumn, keepActualsWithoutPredictions = TRUE, ...) {
  deploymentDatasetCreate <- datarobot.apicore::DeploymentDatasetCreate$new(password = password, wasActedOnColumn = wasActedOnColumn, associationIdColumn = associationIdColumn, actualValueColumn = actualValueColumn, datasetId = datasetId, user = user, keepActualsWithoutPredictions = keepActualsWithoutPredictions, datasetVersionId = datasetVersionId, timestampColumn = timestampColumn, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsActualsFromDatasetCreate(deploymentDatasetCreate = deploymentDatasetCreate, deploymentId = deploymentId))
}

#' SubmitActuals
#'
#' Submit actuals values
#'
#' Submit actuals values for processing. Values are not processed immediately and may take some time to propagate through deployment systems. Submission of actuals is limited to 10,000,000 actuals per hour. For time series deployments, total actuals = number of actuals * number of forecast distances. For example, submitting 10 actuals for a deployment with 50 forecast distances = 500 total actuals. For multiclass deployments, a similar calculation is made where total actuals = number of actuals * number of classes. For example, submitting 10 actuals for a deployment with 20 classes = 200 actuals.
#'
#' @seealso The method DeploymentsActualsFromJSONCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
SubmitActuals <- function(actuals, deploymentId, batchSize = 10000, ...) {

  # It's not you, it's R: https://developer.r-project.org/Blog/public/2020/02/16/stringsasfactors/
  # Force factor columns to character to allow for validation.
  factors <- sapply(actuals, is.factor)
  actuals[factors] <- lapply(actuals[factors], as.character)

  ValidateActuals(actuals)

  # Format timestamps as RFC3339
  if ("timestamp" %in% names(actuals)) {
    actuals[["timestamp"]] <- formatRFC3339Timestamp(actuals[["timestamp"]])
  }
  routeString <- UrlJoin("deployments", deploymentId, "actuals", "fromJSON")
  for (batch in split(actuals, (seq(nrow(actuals)) - 1) %/% batchSize)) {
    payload <- list(data = batch)
    # start of generated addition
    # end of generated addition
    postResponse <- DataRobotPOST(routeString, body = payload, addUrl = TRUE, encode = "json", returnRawResponse = TRUE)
    WaitForAsyncReturn(GetRedirectFromResponse(postResponse),
      addUrl = FALSE,
      failureStatuses = "ERROR"
    )
  }
}

#' CreateDeploymentsChallengerPredictions
#'
#' Score challenger models
#'
#' Score main model prediction requests against challenger model requests.
#'
#' @seealso The method DeploymentsChallengerPredictionsCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsChallengerPredictions <- function(deploymentId, timestamp, ...) {
  challengerScore <- datarobot.apicore::ChallengerScore$new(timestamp = timestamp, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsChallengerPredictionsCreate(deploymentId = deploymentId, challengerScore = challengerScore))
}

#' CreateDeploymentsChallengers
#'
#' Create challenger model
#'
#' Create new challenger model.
#'
#' @seealso The method DeploymentsChallengersCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsChallengers <- function(deploymentId, name, predictionEnvironmentId, modelPackageId, ...) {
  challengerCreate <- datarobot.apicore::ChallengerCreate$new(name = name, predictionEnvironmentId = predictionEnvironmentId, modelPackageId = modelPackageId, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsChallengersCreate(deploymentId = deploymentId, challengerCreate = challengerCreate))
}

#' DeleteDeploymentsChallengers
#'
#' Delete challenger model
#'
#' Delete challenger model.
#'
#' @seealso The method DeploymentsChallengersDelete in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
DeleteDeploymentsChallengers <- function(deploymentId, challengerId, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsChallengersDelete(deploymentId = deploymentId, challengerId = challengerId))
}

#' ListDeploymentsChallengers
#'
#' List challenger models
#'
#' List challenger models for deployment.
#'
#' @seealso The method DeploymentsChallengersList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsChallengers <- function(deploymentId, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsChallengersList(deploymentId = deploymentId))
}

#' PatchDeploymentsChallengers
#'
#' Update challenger model
#'
#' Update challenger model.
#'
#' @seealso The method DeploymentsChallengersPatch in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
PatchDeploymentsChallengers <- function(deploymentId, name, challengerId, predictionEnvironmentId, ...) {
  challengerUpdate <- datarobot.apicore::ChallengerUpdate$new(name = name, predictionEnvironmentId = predictionEnvironmentId, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsChallengersPatch(deploymentId = deploymentId, challengerUpdate = challengerUpdate, challengerId = challengerId))
}

#' RetrieveDeploymentsChallengers
#'
#' Get challenger model
#'
#' Retrieve challenger model.
#'
#' @seealso The method DeploymentsChallengersRetrieve in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
RetrieveDeploymentsChallengers <- function(deploymentId, challengerId, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsChallengersRetrieve(deploymentId = deploymentId, challengerId = challengerId))
}

#' DeleteDeployment
#'
#' Delete deployment
#'
#' Delete a deployment.
#'
#' @seealso The method DeploymentsDelete in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
DeleteDeployment <- function(deploymentId, ignoreManagementAgent = "false", ...) {
  if (is.dataRobotDeployment(deploymentId)) {
    deploymentId <- deploymentId$id
  }
  routeString <- UrlJoin("deployments", deploymentId)
  # start of generated addition
  query <- get0("query", mode = "list", ifnotfound = list())
  query$ignoreManagementAgent <- ignoreManagementAgent
  # end of generated addition
  DataRobotDELETE(routeString, query = query)
  invisible(NULL)
}

#' ListDeploymentsFeatureDrift
#'
#' Retrieve feature drift scores
#'
#' Retrieve drift scores for features of the deployment.
#'
#' @seealso The method DeploymentsFeatureDriftList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsFeatureDrift <- function(segmentAttribute, modelId, deploymentId, start, end, offset = 0, metric = "psi", limit = 200, segmentValue = "", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsFeatureDriftList(segmentAttribute = segmentAttribute, offset = offset, metric = metric, modelId = modelId, deploymentId = deploymentId, limit = limit, start = start, segmentValue = segmentValue, end = end))
}

#' ListDeploymentsFeatures
#'
#' Get deployment features
#'
#' Retrieve features contained within the universe dataset associated with a specific deployment. By default, this returns all raw features required for predictions.
#'
#' @seealso The method DeploymentsFeaturesList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsFeatures <- function(search, deploymentId, offset = 0, includeNonPredictionFeatures = "false", limit = 50, forSegmentedAnalysis = "false", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsFeaturesList(search = search, offset = offset, includeNonPredictionFeatures = includeNonPredictionFeatures, deploymentId = deploymentId, limit = limit, forSegmentedAnalysis = forSegmentedAnalysis))
}

#' CreateDeployment
#'
#' Create deployment from DataRobot model
#'
#' Create a deployment from a DataRobot model.
#'
#' @seealso The method DeploymentsFromLearningModelCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeployment <- function(model, label = "", description = "", defaultPredictionServerId = NULL, ...) {
  if (is(model, "dataRobotModel")) {
    modelId <- ValidateAndReturnModel(model)$modelId
  } else {
    modelId <- model
  }
  if (is(defaultPredictionServerId, "dataRobotPredictionServer")) {
    defaultPredictionServerId <- defaultPredictionServerId$id
  }
  body <- list(
    modelId = modelId,
    label = label,
    description = description
  )
  body$defaultPredictionServerId <- defaultPredictionServerId
  routeString <- UrlJoin("deployments", "fromLearningModel")
  # start of generated addition
  # end of generated addition
  deploymentId <- DataRobotPOST(routeString, body = body)$id
  GetDeployment(deploymentId)
}

#' CreateDeploymentsFromProjectRecommendedModel
#'
#' Create deployment from recommended model
#'
#' Create a deployment for a recommended model
#'
#' @seealso The method DeploymentsFromProjectRecommendedModelCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsFromProjectRecommendedModel <- function(importance, defaultPredictionServerId, label, projectId, description = "null", ...) {
  deploymentCreateFromProjectRecommendedModel <- datarobot.apicore::DeploymentCreateFromProjectRecommendedModel$new(importance = importance, description = description, defaultPredictionServerId = defaultPredictionServerId, label = label, projectId = projectId, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsFromProjectRecommendedModelCreate(deploymentCreateFromProjectRecommendedModel = deploymentCreateFromProjectRecommendedModel))
}

#' ListDeploymentsHumilityStats
#'
#' Retrieve humility stats
#'
#' Retrieve humility rule service triggers statistics overview.
#'
#' @seealso The method DeploymentsHumilityStatsList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsHumilityStats <- function(segmentAttribute, modelId, deploymentId, start, end, bucketSize, segmentValue = "", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsHumilityStatsList(segmentAttribute = segmentAttribute, modelId = modelId, deploymentId = deploymentId, start = start, segmentValue = segmentValue, end = end, bucketSize = bucketSize))
}

#' ListDeploymentsHumilityStatsOverTime
#'
#' Retrieve humility stats over time
#'
#' Retrieve humility service statistics over time.
#'
#' @seealso The method DeploymentsHumilityStatsOverTimeList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsHumilityStatsOverTime <- function(segmentAttribute, modelId, deploymentId, start, end, bucketSize, segmentValue = "", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsHumilityStatsOverTimeList(segmentAttribute = segmentAttribute, modelId = modelId, deploymentId = deploymentId, start = start, segmentValue = segmentValue, end = end, bucketSize = bucketSize))
}

#' ListDeployments
#'
#' List deployments
#'
#' List deployments a user can view.
#'
#' @seealso The method DeploymentsList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeployments <- function(orderBy = NULL, search = NULL, offset = 0, limit = 20, serviceHealth = NULL, modelHealth = NULL, accuracyHealth = NULL, role = NULL, status = NULL, importance = NULL, lastPredictionTimestampStart = NULL, lastPredictionTimestampEnd = NULL, predictionUsageDailyAvgGreaterThan = NULL, predictionUsageDailyAvgLessThan = NULL, defaultPredictionServerId = NULL, buildEnvironmentType = NULL, executionEnvironmentType = NULL, predictionEnvironmentPlatform = NULL, hasDecisionFlow = NULL, ...) {
  query <- list("orderBy" = orderBy, "search" = search)
  # start of generated addition
  query <- get0("query", mode = "list", ifnotfound = list())
  query$offset <- offset
  query$limit <- limit
  query$serviceHealth <- serviceHealth
  query$modelHealth <- modelHealth
  query$accuracyHealth <- accuracyHealth
  query$role <- role
  query$status <- status
  query$importance <- importance
  query$lastPredictionTimestampStart <- lastPredictionTimestampStart
  query$lastPredictionTimestampEnd <- lastPredictionTimestampEnd
  query$predictionUsageDailyAvgGreaterThan <- predictionUsageDailyAvgGreaterThan
  query$predictionUsageDailyAvgLessThan <- predictionUsageDailyAvgLessThan
  query$defaultPredictionServerId <- defaultPredictionServerId
  query$buildEnvironmentType <- buildEnvironmentType
  query$executionEnvironmentType <- executionEnvironmentType
  query$predictionEnvironmentPlatform <- predictionEnvironmentPlatform
  query$hasDecisionFlow <- hasDecisionFlow
  # end of generated addition
  response <- DataRobotGET("deployments", simplifyDataFrame = FALSE, query = query)
  # TODO: Remove the default batch size after https://datarobot.atlassian.net/browse/DSX-864
  response <- GetServerDataInRows(response, 20)
  response <- lapply(response, as.dataRobotDeployment)
  class(response) <- c("listOfDeployments", "listSubclass")
  response
}

#' ReplaceDeployedModel
#'
#' Model Replacement.
#'
#' Replace the model used to make predictions for the deployment. A validation process will be performed to make sure the new model is eligible as a replacement. If the validation fails, the model replacement will not occur.The Model Replacement Validation endpoint can be used to confirm the new model is eligible as a replacement.
#'
#' @seealso The method DeploymentsModelPatchMany in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ReplaceDeployedModel <- function(deploymentId, newModelId, replacementReason, maxWait = 600, ...) {
  if (is.dataRobotDeployment(deploymentId)) {
    deploymentId <- deploymentId$id
  }
  if (is(newModelId, "dataRobotModel")) {
    newModelId <- ValidateAndReturnModel(newModelId)$modelId
  }
  routeString <- UrlJoin("deployments", deploymentId, "model")
  body <- list(modelId = newModelId, reason = replacementReason)
  # start of generated addition
  # end of generated addition
  response <- DataRobotPATCH(routeString, body = body, returnRawResponse = TRUE, stopOnError = FALSE, encode = "json")
  HandleDeploymentErrors(response)
  response <- WaitForAsyncReturn(GetRedirectFromResponse(response),
    addUrl = FALSE,
    maxWait = maxWait,
    failureStatuses = "ERROR"
  )
  as.dataRobotDeployment(response)
}

#' ListDeploymentsModelSecondaryDatasetConfigurationHistory
#'
#' List the secondary datasets configuration history for a deployment
#'
#' List all the secondary datasets configuration used by a given Feature Discovery deployment
#'
#' @seealso The method DeploymentsModelSecondaryDatasetConfigurationHistoryList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsModelSecondaryDatasetConfigurationHistory <- function(deploymentId, offset = 0, limit = 100, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsModelSecondaryDatasetConfigurationHistoryList(offset = offset, deploymentId = deploymentId, limit = limit))
}

#' ListDeploymentsModelSecondaryDatasetConfiguration
#'
#' Retrieve secondary datasets configuration for a deployment.
#'
#' Retrieve the secondary datasets configuration used by a deployed Feature discovery model.
#'
#' @seealso The method DeploymentsModelSecondaryDatasetConfigurationList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsModelSecondaryDatasetConfiguration <- function(deploymentId, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsModelSecondaryDatasetConfigurationList(deploymentId = deploymentId))
}

#' PatchManyDeploymentsModelSecondaryDatasetConfiguration
#'
#' Update the secondary datasets configuration for the deployed model.
#'
#' Update the secondary datasets configuration used by the deployed feature discovery model.
#'
#' @seealso The method DeploymentsModelSecondaryDatasetConfigurationPatchMany in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
PatchManyDeploymentsModelSecondaryDatasetConfiguration <- function(secondaryDatasetConfigId, credentialsIds, deploymentId, ...) {
  secondaryDatasetConfigUpdate <- datarobot.apicore::SecondaryDatasetConfigUpdate$new(secondaryDatasetConfigId = secondaryDatasetConfigId, credentialsIds = credentialsIds, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsModelSecondaryDatasetConfigurationPatchMany(secondaryDatasetConfigUpdate = secondaryDatasetConfigUpdate, deploymentId = deploymentId))
}

#' ValidateReplaceDeployedModel
#'
#' Model Replacement Validation.
#'
#' Validate that a model can be used to replace the current model of the deployment.
#'
#' @seealso The method DeploymentsModelValidationCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ValidateReplaceDeployedModel <- function(deploymentId, newModelId, ...) {
  if (is.dataRobotDeployment(deploymentId)) {
    deploymentId <- deploymentId$id
  }
  if (is(newModelId, "dataRobotModel")) {
    newModelId <- ValidateAndReturnModel(newModelId)$modelId
  }
  routeString <- UrlJoin("deployments", deploymentId, "model", "validation")
  body <- list(modelId = newModelId)
  # start of generated addition
  # end of generated addition
  response <- DataRobotPOST(routeString, body = body, encode = "json")
  return(response)
}

#' CreateDeploymentsOnDemandReports
#'
#' Add report to execution queue.
#'
#' Add report to execution queue.
#'
#' @seealso The method DeploymentsOnDemandReportsCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsOnDemandReports <- function(deploymentId, id, ...) {
  scheduledReportOnDemmand <- datarobot.apicore::ScheduledReportOnDemmand$new(id = id, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsOnDemandReportsCreate(deploymentId = deploymentId, scheduledReportOnDemmand = scheduledReportOnDemmand))
}

#' PatchDeployments
#'
#' Update deployment
#'
#' Update a deployment's label and description.
#'
#' @seealso The method DeploymentsPatch in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
PatchDeployments <- function(importance, deploymentId, description, label, ...) {
  deploymentUpdate <- datarobot.apicore::DeploymentUpdate$new(importance = importance, description = description, label = label, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsPatch(deploymentUpdate = deploymentUpdate, deploymentId = deploymentId))
}

#' CreateDeploymentsPredictionInputsFromDataset
#'
#' Submit external deployment prediction data.
#'
#' Assigns prediction dataset to the external deployment to enable the analysis of historical model performance. Multiple datasets containing historical predictions for the external deployment can be uploaded. This requires one request for each dataset. For a regression deployment, predictions can be either an int or float. For a classification (binary/multiclass) deployment, predictions must be lists with each list containing probabilities for each class.
#'
#' @seealso The method DeploymentsPredictionInputsFromDatasetCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsPredictionInputsFromDataset <- function(deploymentId, datasetId, datasetVersionId, ...) {
  predictionDatasetAssignment <- datarobot.apicore::PredictionDatasetAssignment$new(datasetId = datasetId, datasetVersionId = datasetVersionId, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsPredictionInputsFromDatasetCreate(deploymentId = deploymentId, predictionDatasetAssignment = predictionDatasetAssignment))
}

#' ListDeploymentsPredictionResults
#'
#' Retrieve predictions results.
#'
#' Retrieve predictions results of the deployment.
#'
#' @seealso The method DeploymentsPredictionResultsList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsPredictionResults <- function(actualsPresent, modelId, deploymentId, start, end, accept, offset = 0, limit = 100, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsPredictionResultsList(offset = offset, actualsPresent = actualsPresent, modelId = modelId, deploymentId = deploymentId, limit = limit, start = start, end = end, accept = accept))
}

#' CreateDeploymentsPredictions
#'
#' Compute predictions synchronously
#'
#' The route can be used for low-latency (hence synchronous) predictions. Scoring dataset, however, must be up to 50 MB and is limited by comma-delimited CSV and record oriented JSON. All other formats are not supported.
#'
#' @seealso The method DeploymentsPredictionsCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsPredictions <- function(predictionsEndDate, maxExplanations, predictionWarningEnabled, maxCodes, relaxKnownInAdvanceFeaturesCheck, predictionsStartDate, passthroughColumnsSet, passthroughColumns, deploymentId, forecastPoint, thresholdHigh, thresholdLow, excludeAdjustedPredictions = TRUE, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsPredictionsCreate(predictionsEndDate = predictionsEndDate, maxExplanations = maxExplanations, predictionWarningEnabled = predictionWarningEnabled, maxCodes = maxCodes, excludeAdjustedPredictions = excludeAdjustedPredictions, relaxKnownInAdvanceFeaturesCheck = relaxKnownInAdvanceFeaturesCheck, predictionsStartDate = predictionsStartDate, passthroughColumnsSet = passthroughColumnsSet, passthroughColumns = passthroughColumns, deploymentId = deploymentId, forecastPoint = forecastPoint, thresholdHigh = thresholdHigh, thresholdLow = thresholdLow))
}

#' GetDeployment
#'
#' Retrieve deployment
#'
#' Retrieve a deployment.
#'
#' @seealso The method DeploymentsRetrieve in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
GetDeployment <- function(deploymentId, ...) {
  routeString <- UrlJoin("deployments", deploymentId)
  # start of generated addition
  # end of generated addition
  deployment <- DataRobotGET(routeString)
  as.dataRobotDeployment(deployment)
}

#' CreateDeploymentsScoringCodeBuilds
#'
#' Build Java package containing Scoring Code with agent integration.
#'
#' Build Java package containing Scoring Code with agent integration.
#'
#' @seealso The method DeploymentsScoringCodeBuildsCreate in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
CreateDeploymentsScoringCodeBuilds <- function(includeAgent, includePredictionExplanations, deploymentId, includePredictionIntervals, ...) {
  deploymentsScoringCodeBuildPayload <- datarobot.apicore::DeploymentsScoringCodeBuildPayload$new(includeAgent = includeAgent, includePredictionExplanations = includePredictionExplanations, includePredictionIntervals = includePredictionIntervals, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsScoringCodeBuildsCreate(deploymentsScoringCodeBuildPayload = deploymentsScoringCodeBuildPayload, deploymentId = deploymentId))
}

#' ListDeploymentsScoringCode
#'
#' Retrieve Scoring Code
#'
#' Retrieve Scoring Code of the current deployed model for making predictions outside of a DataRobot prediction server. You need the \"Scoring Code\" feature enabled to use this route.  By default, returns a compiled executable JAR that can be executed locally to calculate model predictions, or it can be used as a library for a Java application. Execute it with the '--help` parameters to learn how to use it as a command-line utility. See model API documentation at https://javadoc.io/doc/com.datarobot/datarobot-prediction/latest/index.html to be able to use it inside an existing Java application.  With sourceCode query parameter set to 'true', returns a source code archive that can be used to review internal calculations of the model. This JAR is NOT executable.  See \"https://app.datarobot.com/docs/predictions/scoring-code/scorecode.html\" documentation in DataRobot application for more information.  *Note* Cannot retrieve source code if agent is included.
#'
#' @seealso The method DeploymentsScoringCodeList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsScoringCode <- function(deploymentId, includeAgent = "false", sourceCode = "false", includePredictionExplanations = "false", includePredictionIntervals = "false", includePe = "false", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsScoringCodeList(includeAgent = includeAgent, sourceCode = sourceCode, includePredictionExplanations = includePredictionExplanations, deploymentId = deploymentId, includePredictionIntervals = includePredictionIntervals, includePe = includePe))
}

#' GetDeploymentServiceStats
#'
#' Retrieve service statistics
#'
#' Retrieve deployment service health statistics overview.
#'
#' @seealso The method DeploymentsServiceStatsList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
GetDeploymentServiceStats <- function(deploymentId, modelId = NULL, start = NULL, end = NULL, executionTimeQuantile = NULL, responseTimeQuantile = NULL, slowRequestsThreshold = NULL, segmentAttribute = NULL, segmentValue = NULL, bucketSize = NULL, monitoringType = "serviceHealth", ...) {
  routeString <- UrlJoin("deployments", deploymentId, "serviceStats")
  query <- list()
  query$modelId <- modelId
  if (!is.null(start) && validateReportingPeriodTime(start, "start")) {
    query$start <- formatRFC3339Timestamp(start)
  }
  if (!is.null(end) && validateReportingPeriodTime(end, "end")) {
    query$end <- formatRFC3339Timestamp(end)
  }
  query$executionTimeQuantile <- executionTimeQuantile
  query$responseTimeQuantile <- responseTimeQuantile
  query$slowRequestsThreshold <- slowRequestsThreshold
  query$segmentAttribute <- segmentAttribute
  query$segmentValue <- segmentValue
  # start of generated addition
  query <- get0("query", mode = "list", ifnotfound = list())
  query$bucketSize <- bucketSize
  query$monitoringType <- monitoringType
  # end of generated addition
  response <- DataRobotGET(routeString, query = query)
  as.dataRobotDeploymentServiceStats(response)
}

#' ListDeploymentsServiceStatsOverTime
#'
#' Retrieve service statistics over time
#'
#' Retrieve deployment service health statistics over time data for one single metric.
#'
#' @seealso The method DeploymentsServiceStatsOverTimeList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsServiceStatsOverTime <- function(segmentAttribute, modelId, quantile, deploymentId, start, threshold, end, bucketSize, metric = "totalPredictions", segmentValue = "", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsServiceStatsOverTimeList(segmentAttribute = segmentAttribute, modelId = modelId, metric = metric, quantile = quantile, deploymentId = deploymentId, start = start, segmentValue = segmentValue, threshold = threshold, end = end, bucketSize = bucketSize))
}

#' GetDeploymentSettings
#'
#' Get deployment settings
#'
#' Retrieve deployment settings.
#'
#' @seealso The method DeploymentsSettingsList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
GetDeploymentSettings <- function(deployment, ...) {
  if (is.dataRobotDeployment(deployment)) {
    deployment <- deployment$id
  }
  routeString <- UrlJoin("deployments", deployment, "settings")
  # start of generated addition
  # end of generated addition
  response <- DataRobotGET(routeString)
  class(response) <- "dataRobotDeploymentSettings"
  response
}


#' ListDeploymentsSharedRoles
#'
#' Get model deployment's access control list
#'
#' Get a list of users, groups and organizations who have access to this deployment and their roles.
#'
#' @seealso The method DeploymentsSharedRolesList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsSharedRoles <- function(shareRecipientType, deploymentId, name, id, offset = 0, limit = 10, ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsSharedRolesList(shareRecipientType = shareRecipientType, offset = offset, deploymentId = deploymentId, name = name, limit = limit, id = id))
}

#' PatchManyDeploymentsSharedRoles
#'
#' Update model deployment's controls
#'
#' Set roles for users on this model deployment.
#'
#' @seealso The method DeploymentsSharedRolesPatchMany in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
PatchManyDeploymentsSharedRoles <- function(roles, deploymentId, operation, ...) {
  sharedRolesUpdateWithGrant <- datarobot.apicore::SharedRolesUpdateWithGrant$new(roles = roles, operation = operation, validateParams = TRUE)
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsSharedRolesPatchMany(sharedRolesUpdateWithGrant = sharedRolesUpdateWithGrant, deploymentId = deploymentId))
}

#' ListDeploymentsTargetDrift
#'
#' Retrieve target drift
#'
#' Retrieve target drift data.
#'
#' @seealso The method DeploymentsTargetDriftList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListDeploymentsTargetDrift <- function(segmentAttribute, modelId, deploymentId, start, end, metric = "psi", segmentValue = "", ...) {
  return(datarobot.apicore::DeploymentsApi$new()$DeploymentsTargetDriftList(segmentAttribute = segmentAttribute, metric = metric, modelId = modelId, deploymentId = deploymentId, start = start, segmentValue = segmentValue, end = end))
}

#' ListPredictionServers
#'
#' List prediction servers.
#'
#' List prediction servers available for a user.
#'
#' @seealso The method PredictionServersList in [datarobot.apicore::DeploymentsApi], which this function wraps.
#' @family Deployments
#' @export
ListPredictionServers <- function(offset = 0, limit = 100, ...) {

  # start of generated addition
  query <- get0("query", mode = "list", ifnotfound = list())
  query$offset <- offset
  query$limit <- limit
  # end of generated addition
  response <- DataRobotGET("predictionServers", simplifyDataFrame = FALSE, query = query)
  response <- GetServerDataInRows(response)
  response <- lapply(response, as.dataRobotPredictionServer)
  class(response) <- c("listOfPredictionServers", "listSubclass")
  response
}
